<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Crop Advisory System</title>
<style>
body { font-family: Arial, sans-serif; background: #f9fff4; margin:0; padding:0; }
header { background: #2e7d32; color: white; text-align: center; padding: 1rem; }
.container { padding: 1rem; }
.card { background: white; padding: 1rem; margin-bottom: 1rem; border-radius: 10px; box-shadow: 0px 2px 8px rgba(0,0,0,0.1); }
button { background: #2e7d32; color: white; border: none; padding: 10px; margin-top: 10px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1rem; }
button:hover { background: #1b5e20; }
input[type="text"], select, input[type="file"] { padding: 8px; width: 100%; margin-top: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; }
p { font-size: 1rem; margin-top: 0.5rem; }
img { max-width: 100%; margin-top: 10px; border-radius: 10px; }
</style>
</head>
<body>

<header>
  <h1 id="appTitle"></h1>
  <p id="appSubtitle"></p>
</header>

<div class="container">

  <!-- Language Selection -->
  <div class="card">
    <h2 id="langTitle"></h2>
    <select id="langSelect" onchange="changeLanguage()">
      <option value="en">English</option>
      <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
      <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
      <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
      <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
    </select>
  </div>

  <!-- Crop Input Section -->
  <div class="card">
    <h2 id="cropTitle"></h2>
    <input type="text" id="cropInput" placeholder="">
    <button id="submitBtn" onclick="submitCrop()"></button>
    <button id="voiceBtn" onclick="startRecognition()"></button>
    <p><b id="chosenLabel"></b> <span id="voiceText">---</span></p>
    <p id="adviceResult" style="color: green; font-weight: bold;"></p>
  </div>

  <!-- Image Upload Section -->
  <div class="card">
    <h2 id="imageTitle"></h2>
    <input type="file" id="cropImage" accept="image/*">
    <button id="analyzeBtn" onclick="analyzeImage()"></button>
    <p id="imageResult" style="color: darkorange; font-weight: bold;"></p>
    <img id="previewImg" src="" alt="">
  </div>

  <!-- Location + Weather + Mandi Prices -->
  <div class="card">
    <h2 id="locationTitle"></h2>
    <button id="locationBtn" onclick="getLocation()"></button>
    <p id="locationResult">---</p>
    <p id="weatherResult" style="color: blue; font-weight: bold;"></p>
    <p id="marketResult" style="color: brown; font-weight: bold;"></p>
  </div>

</div>

<script>
// ------------------- Multi-language Dictionary -------------------
let currentLang = "en";
let currentCrop = "";

const translations = {
  en: { 
    appTitle: "üå± Smart Crop Advisory System",
    appSubtitle: "Voice/Typing + Multi-language + Weather + Mandi Prices + Image Suggestions",
    langTitle: "Select Language",
    cropTitle: "Enter or Speak Your Crop Name",
    cropPlaceholder: "Type crop name",
    submitBtn: "Submit Crop",
    voiceBtn: "üé§ Speak Crop Name",
    chosenLabel: "You chose:",
    imageTitle: "Upload Crop Image for Suggestions",
    analyzeBtn: "Analyze Image",
    locationTitle: "üìç Your Location & Weather & Mandi Prices",
    locationBtn: "Get My Weather & Mandi Prices",
    alerts: { emptyCrop:"Please type a crop name or use voice input.", emptyImage:"Please upload an image first.", voiceError:"Voice recognition error.", enterCropForLocation:"Please enter or speak a crop first.", locationNotSupported:"Geolocation is not supported by your browser.", locationDenied:"Location access is required to use this app." },
    advisories: { wheat:"For Wheat: Irrigate lightly this week and apply nitrogen fertilizer.", rice:"For Rice: Maintain standing water and check for pests.", maize:"For Maize: Ensure soil moisture, apply potash at knee-high stage.", general:"General Tip: Use organic manure and monitor pests regularly." },
    imageSuggestions:["Yellow leaves ‚Üí possible nitrogen deficiency.","Brown spots ‚Üí possible fungal infection.","Curling leaves ‚Üí possible water stress.","Healthy ‚Üí keep following current practices."],
    mandiMessage:(crop, price)=>`Current mandi price of ${crop}: ‚Çπ${price} per quintal`,
    weatherTips:{hot:"High heat, irrigate crops adequately.", humid:"High humidity, watch for fungal diseases.", normal:"Normal weather, continue regular practices."}
  },
  ta: {
    appTitle: "üå± ‡Æ™‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æ£‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà ‡ÆÆ‡ØÅ‡Æ±‡Øà‡ÆÆ‡Øà",
    appSubtitle: "‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç/‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ + ‡Æ™‡Æ≤ ‡ÆÆ‡Øä‡Æ¥‡Æø‡Æï‡Æ≥‡Øç + ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà + ‡ÆÆ‡Æ£‡Øç‡Æü‡Æø ‡Æµ‡Æø‡Æ≤‡Øà + ‡Æ™‡Æü ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà",
    langTitle: "‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ",
    cropTitle: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡Øã ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æ™‡Øá‡Æö‡Æµ‡Øã ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç",
    cropPlaceholder: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç",
    submitBtn: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æö‡ÆÆ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
    voiceBtn: "üé§ ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Æµ‡ØÅ‡ÆÆ‡Øç",
    chosenLabel: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ§‡ØÅ:",
    imageTitle: "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
    analyzeBtn: "‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç",
    locationTitle: "üìç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æü‡ÆÆ‡Øç & ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà & ‡ÆÆ‡Æ£‡Øç‡Æü‡Æø ‡Æµ‡Æø‡Æ≤‡Øà",
    locationBtn: "‡Æé‡Æ©‡Øç ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Æ£‡Øç‡Æü‡Æø ‡Æµ‡Æø‡Æ≤‡Øà ‡Æ™‡ØÜ‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
    alerts:{ emptyCrop:"‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç.", emptyImage:"‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç.", voiceError:"‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÖ‡Æô‡Øç‡Æï‡ØÄ‡Æï‡Ææ‡Æ∞‡ÆÆ‡Øç ‡Æ™‡Æø‡Æ¥‡Øà.", enterCropForLocation:"‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æ§‡Æ≤‡Æø‡Æ≤‡Øç ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Æµ‡ØÅ‡ÆÆ‡Øç.", locationNotSupported:"‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≤‡Ææ‡Æµ‡Æø‡ÆØ‡Æø‡Æ≤‡Øç ‡Æá‡Æü‡Æ§‡Øç‡Æ§‡Øà‡Æï‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡ÆÜ‡Æ§‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.", locationDenied:"‡Æá‡Æ®‡Øç‡Æ§ ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡Øç‡Æü‡Øà‡Æ™‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æá‡Æü ‡ÆÖ‡Æ©‡ØÅ‡ÆÆ‡Æ§‡Æø ‡Æ§‡Øá‡Æµ‡Øà."},
    advisories:{ wheat:"‡Æï‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øà: ‡Æá‡Æ®‡Øç‡Æ§ ‡Æµ‡Ææ‡Æ∞‡ÆÆ‡Øç ‡Æö‡Æø‡Æ±‡Æø‡Æ§‡ØÅ ‡Æ®‡ØÄ‡Æ∞‡Øç ‡Æä‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æ®‡Øà‡Æü‡Øç‡Æ∞‡Æú‡Æ©‡Øç ‡Æâ‡Æ∞‡ÆÆ‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç.", rice:"‡ÆÖ‡Æ∞‡Æø‡Æö‡Æø: ‡Æ®‡Æø‡Æ≤‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ®‡ØÄ‡Æ∞‡Øç ‡Æ®‡Æø‡Æ≤‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç, ‡Æ™‡ØÇ‡Æö‡Øç‡Æö‡Æø‡Æï‡Æ≥‡Øç ‡Æ™‡Æ∞‡Æø‡Æö‡Øã‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.", maize:"‡ÆÆ‡Æï‡Øç‡Æï‡Æø: ‡ÆÆ‡Æ£‡Øç‡Æ£‡Æø‡Æ≤‡Øç ‡Æà‡Æ∞‡Æ™‡Øç‡Æ™‡Æ§‡ÆÆ‡Øç ‡Æâ‡Æ±‡ØÅ‡Æ§‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æá‡Æü‡Æø‡ÆØ‡Æ≥‡Æµ‡ØÅ ‡ÆÖ‡Æ≥‡Æµ‡Æø‡Æ≤‡Øç ‡Æ™‡Øä‡Æü‡Øç‡Æü‡Ææ‡Æ∑‡Øç ‡Æï‡Øä‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.", general:"‡Æ™‡Øä‡Æ§‡ØÅ ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà: ‡Æâ‡ÆØ‡Æø‡Æ∞‡Æø‡ÆØ‡Æ≤‡Øç ‡Æâ‡Æ∞‡ÆÆ‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æ™‡ØÇ‡Æö‡Øç‡Æö‡Æø‡Æï‡Æ≥‡Øç ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç."},
    imageSuggestions:["‡ÆÆ‡Æû‡Øç‡Æö‡Æ≥‡Øç ‡Æá‡Æ≤‡Øà‡Æï‡Æ≥‡Øç ‚Üí ‡Æ®‡Øà‡Æü‡Øç‡Æ∞‡Æú‡Æ©‡Øç ‡Æï‡ØÅ‡Æ±‡Øà‡Æµ‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.","‡Æ™‡Æ¥‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æï‡Æ≥‡Øç ‚Üí ‡Æ™‡ØÇ‡Æû‡Øç‡Æö‡Øà ‡Æ®‡Øã‡ÆØ‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.","‡Æµ‡Æ≥‡Øà‡Æ®‡Øç‡Æ§ ‡Æá‡Æ≤‡Øà‡Æï‡Æ≥‡Øç ‚Üí ‡Æ®‡ØÄ‡Æ∞‡Øç ‡Æï‡ØÅ‡Æ±‡Øà‡Æµ‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.","‡Æ®‡Æ≤‡ÆÆ‡Ææ‡Æ©‡Æ§‡ØÅ ‚Üí ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æ®‡Æü‡Øà‡ÆÆ‡ØÅ‡Æ±‡Øà‡ÆØ‡Øà ‡Æ§‡Øä‡Æü‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç."],
    mandiMessage:(crop, price)=>`${crop} ‡Æá‡Æ©‡Øç ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡ÆÆ‡Æ£‡Øç‡Æü‡Æø ‡Æµ‡Æø‡Æ≤‡Øà: ‚Çπ${price} ‡Æï‡Æø‡Æ≤‡Øã‡Æï‡Øç‡Æï‡ØÅ`,
    weatherTips:{hot:"‡Æâ‡ÆØ‡Æ∞‡Øç ‡Æµ‡ØÜ‡Æ™‡Øç‡Æ™‡ÆÆ‡Øç, ‡Æ™‡ÆØ‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Ææ‡Æ© ‡Æ®‡ØÄ‡Æ∞‡Øç ‡Æä‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç.", humid:"‡Æâ‡ÆØ‡Æ∞‡Øç ‡Æà‡Æ∞‡Æ™‡Øç‡Æ™‡Æ§‡ÆÆ‡Øç, ‡Æ™‡ØÇ‡Æû‡Øç‡Æö‡Øà ‡Æ®‡Øã‡ÆØ‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æï‡Æµ‡Æ©‡ÆÆ‡Øç ‡Æµ‡Øà‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.", normal:"‡Æö‡Ææ‡Æ§‡Ææ‡Æ∞‡Æ£ ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà, ‡Æµ‡Æ¥‡Æï‡Øç‡Æï‡ÆÆ‡Ææ‡Æ© ‡Æ®‡Æü‡Øà‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æ§‡Øä‡Æü‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç."}
  },
  // Add ml, kn, te similarly...
};

// ------------------- UI Functions -------------------
function changeLanguage() {
  const tr = translations[currentLang = document.getElementById("langSelect").value];
  document.getElementById("appTitle").innerText = tr.appTitle;
  document.getElementById("appSubtitle").innerText = tr.appSubtitle;
  document.getElementById("langTitle").innerText = tr.langTitle;
  document.getElementById("cropTitle").innerText = tr.cropTitle;
  document.getElementById("cropInput").placeholder = tr.cropPlaceholder;
  document.getElementById("submitBtn").innerText = tr.submitBtn;
  document.getElementById("voiceBtn").innerText = tr.voiceBtn;
  document.getElementById("chosenLabel").innerText = tr.chosenLabel;
  document.getElementById("imageTitle").innerText = tr.imageTitle;
  document.getElementById("analyzeBtn").innerText = tr.analyzeBtn;
  document.getElementById("locationTitle").innerText = tr.locationTitle;
  document.getElementById("locationBtn").innerText = tr.locationBtn;
}

// ------------------- Crop Submit -------------------
function submitCrop() {
  const crop = document.getElementById("cropInput").value.trim().toLowerCase();
  currentCrop = crop;
  if (!crop) { alert(translations[currentLang].alerts.emptyCrop); return; }
  document.getElementById("adviceResult").innerText = translations[currentLang].advisories[crop] || translations[currentLang].advisories.general;
}

// ------------------- Voice Recognition -------------------
function startRecognition() {
  if (!('webkitSpeechRecognition' in window)) { alert(translations[currentLang].alerts.voiceError); return; }
  let recognition = new webkitSpeechRecognition();
  const langMap = {en:'en-US', ta:'ta-IN', ml:'ml-IN', kn:'kn-IN', te:'te-IN'};
  recognition.lang = langMap[currentLang] || 'en-US';
  recognition.onresult = function(event) {
    const text = event.results[0][0].transcript;
    document.getElementById("cropInput").value = text;
    document.getElementById("voiceText").innerText = text;
    submitCrop();
  };
  recognition.onerror = function() { alert(translations[currentLang].alerts.voiceError); };
  recognition.start();
}

// ------------------- Image Analyze -------------------
function analyzeImage() {
  const imgInput = document.getElementById("cropImage");
  if (!imgInput.files.length) { alert(translations[currentLang].alerts.emptyImage); return; }
  const suggestions = translations[currentLang].imageSuggestions;
  const randomSuggestion = suggestions[Math.floor(Math.random()*suggestions.length)];
  document.getElementById("imageResult").innerText = randomSuggestion;
  const reader = new FileReader();
  reader.onload = function(e){ document.getElementById("previewImg").src = e.target.result; }
  reader.readAsDataURL(imgInput.files[0]);
}

// ------------------- Location -------------------
function getLocation() {
  if (!currentCrop) { alert(translations[currentLang].alerts.enterCropForLocation); return; }
  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude, lon = pos.coords.longitude;
      document.getElementById("locationResult").innerText = `Lat: ${lat}, Lon: ${lon}`;
      document.getElementById("weatherResult").innerText = translations[currentLang].weatherTips.normal;
      document.getElementById("marketResult").innerText = translations[currentLang].mandiMessage(currentCrop, Math.floor(Math.random()*5000)+1000);
    },
    err => alert(translations[currentLang].alerts.locationDenied)
  );
}

// ------------------- Location Access Check -------------------
function checkLocationAccess() {
  if (!navigator.geolocation) { alert(translations[currentLang].alerts.locationNotSupported); disableApp(); return; }
  navigator.geolocation.getCurrentPosition(enableApp, err => { alert(translations[currentLang].alerts.locationDenied); disableApp(); });
}

function disableApp() { document.querySelectorAll("input, button, select").forEach(e=>e.disabled=true); }
function enableApp() { document.querySelectorAll("input, button, select").forEach(e=>e.disabled=false); }

// ------------------- Initialize -------------------
window.onload = function() { changeLanguage(); checkLocationAccess(); };
</script>

</body>
</html>
